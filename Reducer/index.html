<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComposableArchitecture - Reducer</title>
    <link rel="stylesheet" type="text/css" href="/swift-composable-architecture/all.css" media="all" />
</head>
<body>
    <header>
        <a href="/swift-composable-architecture/">
            <strong>
                ComposableArchitecture
            </strong>
            <span>Documentation</span>
        </a>
        <sup>Beta</sup>
    </header>

    <!--
    <form class="search">
        <input type="search" placeholder="Search" />
    </form>
    -->

    <nav>
        <div class="wrapper">
            <h2>On This Page</h2>
            <ol><li><a href="#initializers">Initializers</a><ul><li class="initializer"><a href="#reducer.init(_:)">init(_:​)</a></li></ul></li><li><a href="#properties">Properties</a><ul><li class="variable"><a href="#reducer.optional">optional</a></li><li class="variable"><a href="#reducer.empty">empty</a></li></ul></li><li><a href="#methods">Methods</a><ul><li class="function"><a href="#reducer.debug(_:actionformat:environment:)">debug(_:​action​Format:​environment:​)</a></li><li class="function"><a href="#reducer.debugactions(_:actionformat:environment:)">debug​Actions(_:​action​Format:​environment:​)</a></li><li class="function"><a href="#reducer.debug(_:state:action:actionformat:environment:)">debug(_:​state:​action:​action​Format:​environment:​)</a></li><li class="function"><a href="#reducer.signpost(_:log:)">signpost(_:​log:​)</a></li><li class="function"><a href="#reducer.debug(prefix:environment:)">debug(prefix:​environment:​)</a></li><li class="function"><a href="#reducer.debugactions(prefix:environment:)">debug​Actions(prefix:​environment:​)</a></li><li class="function"><a href="#reducer.debug(prefix:state:action:environment:)">debug(prefix:​state:​action:​environment:​)</a></li><li class="function"><a href="#reducer.combine(_:)">combine(_:​)</a></li><li class="function"><a href="#reducer.combine(_:)">combine(_:​)</a></li><li class="function"><a href="#reducer.combined(with:)">combined(with:​)</a></li><li class="function"><a href="#reducer.pullback(state:action:environment:)">pullback(state:​action:​environment:​)</a></li><li class="function"><a href="#reducer.optional(_:_:)">optional(_:​_:​)</a></li><li class="function"><a href="#reducer.foreach(state:action:environment:_:_:)">for​Each(state:​action:​environment:​_:​_:​)</a></li><li class="function"><a href="#reducer.foreach(state:action:environment:_:_:)">for​Each(state:​action:​environment:​_:​_:​)</a></li><li class="function"><a href="#reducer.foreach(state:action:environment:_:_:)">for​Each(state:​action:​environment:​_:​_:​)</a></li><li class="function"><a href="#reducer.run(_:_:_:)">run(_:​_:​_:​)</a></li><li class="function"><a href="#reducer.callasfunction(_:_:_:)">call​AsFunction(_:​_:​_:​)</a></li></ul></li></ol>
        </div>
    </nav>

    <main>
        <article>
            <h1>
    <small>Structure</small>
    <code class="name">Reducer</code>
</h1>

<html><body><pre class="highlight"><code><span class="attribute">@</span><span class="attribute">available</span>(<span class="keyword">iOS</span> <span class="number literal">13.0</span>, *) <span class="keyword">public</span> <span class="keyword">struct</span> <span class="type">Reducer</span>&lt;<span class="variable">State</span>, <span class="variable">Action</span>, <span class="variable">Environment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>A reducer describes how to evolve the current state of an application to the next state, given
an action, and describes what <code>Effect</code>s should be executed later by the store, if any.</p>

</div>
<div class="discussion">
    <p>Reducers have 3 generics:</p>

<ul>
<li>
<p><code>State</code>: A type that holds the current state of the application</p>
</li>
<li>
<p><code>Action</code>: A type that holds all possible actions that cause the state of the application to
change.</p>
</li>
<li>
<p><code>Environment</code>: A type that holds all dependencies needed in order to produce <code>Effect</code>s, such
as API clients, analytics clients, random number generators, etc.</p>
</li>
</ul>

<aside class="note">
    <p>The thread on which effects output is important. An effect's output is immediately sent back into the store, and <code>Store</code> is not thread safe. This means all effects must receive values on the same thread, <strong>and</strong> if the <code>Store</code> is being used to drive UI then all output must be on the main thread. You can use the <code>Publisher</code> method <code>receive(on:)</code> for make the effect output its values on the thread of your choice.</p>

</aside>
</div>

    <section id="initializers">
        <h2>Initializers</h2>

        <div role="article" class="initializer" id="reducer.init(_:)">
    <h3>
        <code>init(_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">init</span>(<span class="keyword">_</span> <span class="variable">reducer</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="keyword">inout</span> <span class="type">State</span>, <span class="type">Action</span>, <span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/Effect"><span class="type">Effect</span></a>&lt;<span class="type">Action</span>, <span class="type">Never</span>&gt;)</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Initializes a reducer from a simple reducer function signature.</p>

</div>
<div class="discussion">
    <p>The reducer takes three arguments: state, action and environment. The state is <code>inout</code> so that
you can make any changes to it directly inline. The reducer must return an effect, which
typically would be constructed by using the dependencies inside the <code>environment</code> value. If
no effect needs to be executed, a <code>.none</code> effect can be returned.</p>

<p>For example:</p>

<html><body><pre class="highlight"><code><span class="keyword">struct</span> <span class="type">MyState</span> { <span class="keyword">var</span> <span class="variable">count</span> = <span class="number literal">0</span>, <span class="variable">text</span> = <span class="string literal">"</span><span class="string literal"/><span class="string literal">"</span> }
<span class="keyword">enum</span> <span class="type">MyAction</span> { <span class="keyword">case</span> <span class="variable">buttonTapped</span>, <span class="variable">textChanged</span>(<span class="type">String</span>) }
<span class="keyword">struct</span> <span class="type">MyEnvironment</span> { <span class="keyword">var</span> <span class="variable">analyticsClient</span>: <span class="type">AnalyticsClient</span> }

<span class="keyword">let</span> <span class="variable">myReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">MyState</span>, <span class="type">MyAction</span>, <span class="type">MyEnvironment</span>&gt; { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
  <span class="keyword">switch</span> <span class="variable">action</span> {
  <span class="keyword">case</span> .<span class="variable">buttonTapped</span>:
    <span class="type">state</span>.<span class="type">count</span> += <span class="number literal">1</span>
    <span class="keyword">return</span> <span class="variable">environment</span>.<span class="type">analyticsClient</span>.<span class="type">track</span>(<span class="string literal">"</span><span class="string literal">Button Tapped</span><span class="string literal">"</span>)

  <span class="keyword">case</span> .<span class="variable">textChanged</span>(<span class="keyword">let</span> <span class="variable">text</span>):
    <span class="type">state</span>.<span class="type">text</span> = <span class="variable">text</span>
    <span class="keyword">return</span> .<span class="variable">none</span>
  }
}
</code></pre></body></html>
</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>reducer</th>
    <td><code class="type">@escaping (inout State, Action, Environment) -&gt; Effect&lt;Action, Never&gt;</code></td>
    <td><p>A function signature that takes state, action and environment.</p>
</td>
</tr>
  </tbody>
</table>
</div>
    </section>
    <section id="properties">
        <h2>Properties</h2>

        <div role="article" class="variable" id="reducer.optional">
    <h3>
        <code>optional</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">var</span> <span class="variable">optional</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">State</span>?, <span class="type">Action</span>, <span class="type">Environment</span>&gt;</code></pre></body></html>
</div>
<div role="article" class="variable" id="reducer.empty">
    <h3>
        <code>empty</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">var</span> <span class="variable">empty</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>A reducer that performs no state mutations and returns no effects.</p>

</div>
</div>
    </section>
    <section id="methods">
        <h2>Methods</h2>

        <div role="article" class="function" id="reducer.debug(_:actionformat:environment:)">
    <h3>
        <code>debug(_:​action​Format:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">debug</span>(<span class="keyword">_</span> <span class="variable">prefix</span>: <span class="type">String</span> = <span class="string literal">"</span><span class="string literal"/><span class="string literal">"</span>, <span class="variable">actionFormat</span>: <a href="/swift-composable-architecture/ActionFormat"><span class="type">ActionFormat</span></a> = .<span class="variable">prettyPrint</span>, <span class="variable">environment</span> <span class="variable">toDebugEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/DebugEnvironment"><span class="type">DebugEnvironment</span></a> = { <span class="keyword">_</span> <span class="keyword">in</span>
      <span class="variable">DebugEnvironment</span>()
    }) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Prints debug messages describing all received actions and state mutations.</p>

</div>
<div class="discussion">
    <p>Printing is only done in debug (<code>#if DEBUG</code>) builds.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>prefix</th>
    <td><code class="type">String</code></td>
    <td><p>A string with which to prefix all debug messages.</p>
</td>
</tr>
<tr>
    <th>to​Debug​Environment</th>
    <td><code class="type">@escaping (Environment) -&gt; Debug​Environment</code></td>
    <td><p>A function that transforms an environment into a debug environment by describing a print function and a queue to print from. Defaults to a function that ignores the environment and returns a default <code>DebugEnvironment</code> that uses Swift's <code>print</code> function and a background queue.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that prints debug messages for all received actions.</p>

</div>
<div role="article" class="function" id="reducer.debugactions(_:actionformat:environment:)">
    <h3>
        <code>debug​Actions(_:​action​Format:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">debugActions</span>(<span class="keyword">_</span> <span class="variable">prefix</span>: <span class="type">String</span> = <span class="string literal">"</span><span class="string literal"/><span class="string literal">"</span>, <span class="variable">actionFormat</span>: <a href="/swift-composable-architecture/ActionFormat"><span class="type">ActionFormat</span></a> = .<span class="variable">prettyPrint</span>, <span class="variable">environment</span> <span class="variable">toDebugEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/DebugEnvironment"><span class="type">DebugEnvironment</span></a> = { <span class="keyword">_</span> <span class="keyword">in</span>
      <span class="variable">DebugEnvironment</span>()
    }) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Prints debug messages describing all received actions.</p>

</div>
<div class="discussion">
    <p>Printing is only done in debug (<code>#if DEBUG</code>) builds.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>prefix</th>
    <td><code class="type">String</code></td>
    <td><p>A string with which to prefix all debug messages.</p>
</td>
</tr>
<tr>
    <th>to​Debug​Environment</th>
    <td><code class="type">@escaping (Environment) -&gt; Debug​Environment</code></td>
    <td><p>A function that transforms an environment into a debug environment by describing a print function and a queue to print from. Defaults to a function that ignores the environment and returns a default <code>DebugEnvironment</code> that uses Swift's <code>print</code> function and a background queue.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that prints debug messages for all received actions.</p>

</div>
<div role="article" class="function" id="reducer.debug(_:state:action:actionformat:environment:)">
    <h3>
        <code>debug(_:​state:​action:​action​Format:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">debug</span>&lt;<span class="variable">LocalState</span>, <span class="variable">LocalAction</span>&gt;(<span class="keyword">_</span> <span class="variable">prefix</span>: <span class="type">String</span> = <span class="string literal">"</span><span class="string literal"/><span class="string literal">"</span>, <span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">State</span>) -&gt; <span class="type">LocalState</span>, <span class="variable">action</span> <span class="variable">toLocalAction</span>: <span class="type">CasePath</span>&lt;<span class="type">Action</span>, <span class="type">LocalAction</span>&gt;, <span class="variable">actionFormat</span>: <a href="/swift-composable-architecture/ActionFormat"><span class="type">ActionFormat</span></a> = .<span class="variable">prettyPrint</span>, <span class="variable">environment</span> <span class="variable">toDebugEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/DebugEnvironment"><span class="type">DebugEnvironment</span></a> = { <span class="keyword">_</span> <span class="keyword">in</span>
      <span class="variable">DebugEnvironment</span>()
    }) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Prints debug messages describing all received local actions and local state mutations.</p>

</div>
<div class="discussion">
    <p>Printing is only done in debug (<code>#if DEBUG</code>) builds.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>prefix</th>
    <td><code class="type">String</code></td>
    <td><p>A string with which to prefix all debug messages.</p>
</td>
</tr>
<tr>
    <th>to​Local​State</th>
    <td><code class="type">@escaping (State) -&gt; Local​State</code></td>
    <td><p>A function that filters state to be printed.</p>
</td>
</tr>
<tr>
    <th>to​Local​Action</th>
    <td><code class="type">Case​Path&lt;Action, Local​Action&gt;</code></td>
    <td><p>A case path that filters actions that are printed.</p>
</td>
</tr>
<tr>
    <th>to​Debug​Environment</th>
    <td><code class="type">@escaping (Environment) -&gt; Debug​Environment</code></td>
    <td><p>A function that transforms an environment into a debug environment by describing a print function and a queue to print from. Defaults to a function that ignores the environment and returns a default <code>DebugEnvironment</code> that uses Swift's <code>print</code> function and a background queue.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that prints debug messages for all received actions.</p>

</div>
<div role="article" class="function" id="reducer.signpost(_:log:)">
    <h3>
        <code>signpost(_:​log:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">signpost</span>(<span class="keyword">_</span> <span class="variable">prefix</span>: <span class="type">String</span> = <span class="string literal">"</span><span class="string literal"/><span class="string literal">"</span>, <span class="variable">log</span>: <span class="type">OSLog</span> = <span class="variable">OSLog</span>(
      <span class="variable">subsystem</span>: <span class="string literal">"</span><span class="string literal">co.pointfree.composable-architecture</span><span class="string literal">"</span>,
      <span class="variable">category</span>: <span class="string literal">"</span><span class="string literal">Reducer Instrumentation</span><span class="string literal">"</span>
    )) -&gt; <span class="keyword">Self</span></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Instruments the reducer with
<a href="https://developer.apple.com/documentation/os/logging/recording_performance_data">signposts</a>.
Each invocation of the reducer will be measured by an interval, and the lifecycle of its
effects will be measured with interval and event signposts.</p>

</div>
<div class="discussion">
    <p>To use, build your app for Instruments (⌘I), create a blank instrument, and then use the &quot;+&quot;
icon at top right to add the signpost instrument. Start recording your app (red button at top
left) and then you should see timing information for every action sent to the store and every
effect executed.</p>

<p>Effect instrumentation can be particularly useful for inspecting the lifecycle of long-living
effects. For example, if you start an effect (e.g. a location manager) in <code>onAppear</code> and
forget to tear down the effect in <code>onDisappear</code>, it will clearly show in Instruments that the
effect never completed.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>prefix</th>
    <td><code class="type">String</code></td>
    <td><p>A string to print at the beginning of the formatted message for the signpost.</p>
</td>
</tr>
<tr>
    <th>log</th>
    <td><code class="type">OSLog</code></td>
    <td><p>An <code>OSLog</code> to use for signposts.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that has been enhanced with instrumentation.</p>

</div>
<div role="article" class="function" id="reducer.debug(prefix:environment:)">
    <h3>
        <code>debug(prefix:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="attribute">@</span><span class="attribute">available</span>(*, <span class="variable">unavailable</span>, <span class="variable">renamed</span>: <span class="string literal">"debug(_:environment:)"</span>) <span class="keyword">public</span> <span class="keyword">func</span> <span class="function">debug</span>(<span class="variable">prefix</span>: <span class="type">String</span>, <span class="variable">environment</span> <span class="variable">toDebugEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/DebugEnvironment"><span class="type">DebugEnvironment</span></a> = { <span class="keyword">_</span> <span class="keyword">in</span>
      <span class="variable">DebugEnvironment</span>()
    }) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
</div>
<div role="article" class="function" id="reducer.debugactions(prefix:environment:)">
    <h3>
        <code>debug​Actions(prefix:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="attribute">@</span><span class="attribute">available</span>(*, <span class="variable">unavailable</span>, <span class="variable">renamed</span>: <span class="string literal">"debugActions(_:environment:)"</span>) <span class="keyword">public</span> <span class="keyword">func</span> <span class="function">debugActions</span>(<span class="variable">prefix</span>: <span class="type">String</span>, <span class="variable">environment</span> <span class="variable">toDebugEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/DebugEnvironment"><span class="type">DebugEnvironment</span></a> = { <span class="keyword">_</span> <span class="keyword">in</span>
      <span class="variable">DebugEnvironment</span>()
    }) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
</div>
<div role="article" class="function" id="reducer.debug(prefix:state:action:environment:)">
    <h3>
        <code>debug(prefix:​state:​action:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="attribute">@</span><span class="attribute">available</span>(*, <span class="variable">unavailable</span>, <span class="variable">renamed</span>: <span class="string literal">"debug(_:state:action:environment:)"</span>) <span class="keyword">public</span> <span class="keyword">func</span> <span class="function">debug</span>&lt;<span class="variable">LocalState</span>, <span class="variable">LocalAction</span>&gt;(<span class="variable">prefix</span>: <span class="type">String</span>, <span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">State</span>) -&gt; <span class="type">LocalState</span>, <span class="variable">action</span> <span class="variable">toLocalAction</span>: <span class="type">CasePath</span>&lt;<span class="type">Action</span>, <span class="type">LocalAction</span>&gt;, <span class="variable">environment</span> <span class="variable">toDebugEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/DebugEnvironment"><span class="type">DebugEnvironment</span></a> = { <span class="keyword">_</span> <span class="keyword">in</span>
      <span class="variable">DebugEnvironment</span>()
    }) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
</div>
<div role="article" class="function" id="reducer.combine(_:)">
    <h3>
        <code>combine(_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="function">combine</span>(<span class="keyword">_</span> <span class="variable">reducers</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Combines many reducers into a single one by running each one on state in order, and merging
all of the effects.</p>

</div>
<div class="discussion">
    <p>It is important to note that the order of combining reducers matter. Combining <code>reducerA</code> with
<code>reducerB</code> is not necessarily the same as combining <code>reducerB</code> with <code>reducerA</code>.</p>

<p>This can become an issue when working with reducers that have overlapping domains. For
example, if <code>reducerA</code> embeds the domain of <code>reducerB</code> and reacts to its actions or modifies
its state, it can make a difference if <code>reducerA</code> chooses to modify <code>reducerB</code>'s state
<em>before</em> or <em>after</em> <code>reducerB</code> runs.</p>

<p>This is perhaps most easily seen when working with <code>optional</code> reducers, where the parent
domain may listen to the child domain and <code>nil</code> out its state. If the parent reducer runs
before the child reducer, then the child reducer will not be able to react to its own action.</p>

<p>Similar can be said for a <code>forEach</code> reducer. If the parent domain modifies the child
collection by moving, removing, or modifying an element before the <code>forEach</code> reducer runs, the
<code>forEach</code> reducer may perform its action against the wrong element, an element that no longer
exists, or an element in an unexpected state.</p>

<p>Running a parent reducer before a child reducer can be considered an application logic
error, and can produce assertion failures. So you should almost always combine reducers in
order from child to parent domain.</p>

<p>Here is an example of how you should combine an <code>optional</code> reducer with a parent domain:</p>

<html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">parentReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">ParentState</span>, <span class="type">ParentAction</span>, <span class="type">ParentEnvironment</span>&gt;.<span class="type">combine</span>(
  <span class="comment">// Combined before parent so that it can react to `.dismiss` while state is non-`nil`.</span>
  <span class="variable">childReducer</span>.<span class="type">optional</span>.<span class="type">pullback</span>(
    <span class="variable">state</span>: \.<span class="type">child</span>,
    <span class="variable">action</span>: /<span class="variable">ParentAction</span>.<span class="type">child</span>,
    <span class="variable">environment</span>: { <span class="variable">$0</span>.<span class="type">child</span> }
  ),
  <span class="comment">// Combined after child so that it can `nil` out child state upon `.child(.dismiss)`.</span>
  <span class="variable">Reducer</span> { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
    <span class="keyword">switch</span> <span class="variable">action</span>
    <span class="keyword">case</span> .<span class="variable">child</span>(.<span class="variable">dismiss</span>):
      <span class="type">state</span>.<span class="type">child</span> = <span class="keyword">nil</span>
      <span class="keyword">return</span> .<span class="variable">none</span>
    ...
    }
  },
)
</code></pre></body></html>
</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>reducers</th>
    <td><code class="type">Reducer</code></td>
    <td><p>A list of reducers.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A single reducer.</p>

</div>
<div role="article" class="function" id="reducer.combine(_:)">
    <h3>
        <code>combine(_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="function">combine</span>(<span class="keyword">_</span> <span class="variable">reducers</span>: [<a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>]) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Combines many reducers into a single one by running each one on state in order, and merging
all of the effects.</p>

</div>
<div class="discussion">
    <p>It is important to note that the order of combining reducers matter. Combining <code>reducerA</code> with
<code>reducerB</code> is not necessarily the same as combining <code>reducerB</code> with <code>reducerA</code>.</p>

<p>This can become an issue when working with reducers that have overlapping domains. For
example, if <code>reducerA</code> embeds the domain of <code>reducerB</code> and reacts to its actions or modifies
its state, it can make a difference if <code>reducerA</code> chooses to modify <code>reducerB</code>'s state
<em>before</em> or <em>after</em> <code>reducerB</code> runs.</p>

<p>This is perhaps most easily seen when working with <code>optional</code> reducers, where the parent
domain may listen to the child domain and <code>nil</code> out its state. If the parent reducer runs
before the child reducer, then the child reducer will not be able to react to its own action.</p>

<p>Similar can be said for a <code>forEach</code> reducer. If the parent domain modifies the child
collection by moving, removing, or modifying an element before the <code>forEach</code> reducer runs, the
<code>forEach</code> reducer may perform its action against the wrong element, an element that no longer
exists, or an element in an unexpected state.</p>

<p>Running a parent reducer before a child reducer can be considered an application logic
error, and can produce assertion failures. So you should almost always combine reducers in
order from child to parent domain.</p>

<p>Here is an example of how you should combine an <code>optional</code> reducer with a parent domain:</p>

<html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">parentReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">ParentState</span>, <span class="type">ParentAction</span>, <span class="type">ParentEnvironment</span>&gt;.<span class="type">combine</span>(
  <span class="comment">// Combined before parent so that it can react to `.dismiss` while state is non-`nil`.</span>
  <span class="variable">childReducer</span>.<span class="type">optional</span>.<span class="type">pullback</span>(
    <span class="variable">state</span>: \.<span class="type">child</span>,
    <span class="variable">action</span>: /<span class="variable">ParentAction</span>.<span class="type">child</span>,
    <span class="variable">environment</span>: { <span class="variable">$0</span>.<span class="type">child</span> }
  ),
  <span class="comment">// Combined after child so that it can `nil` out child state upon `.child(.dismiss)`.</span>
  <span class="variable">Reducer</span> { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
    <span class="keyword">switch</span> <span class="variable">action</span>
    <span class="keyword">case</span> .<span class="variable">child</span>(.<span class="variable">dismiss</span>):
      <span class="type">state</span>.<span class="type">child</span> = <span class="keyword">nil</span>
      <span class="keyword">return</span> .<span class="variable">none</span>
    ...
    }
  },
)
</code></pre></body></html>
</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>reducers</th>
    <td><code class="type">[Reducer]</code></td>
    <td><p>An array of reducers.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A single reducer.</p>

</div>
<div role="article" class="function" id="reducer.combined(with:)">
    <h3>
        <code>combined(with:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">combined</span>(<span class="variable">with</span> <span class="variable">other</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a></code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Combines many reducers into a single one by running each one on state in order, and merging
all of the effects.</p>

</div>
<div class="discussion">
    <p>It is important to note that the order of combining reducers matter. Combining <code>reducerA</code> with
<code>reducerB</code> is not necessarily the same as combining <code>reducerB</code> with <code>reducerA</code>.</p>

<p>This can become an issue when working with reducers that have overlapping domains. For
example, if <code>reducerA</code> embeds the domain of <code>reducerB</code> and reacts to its actions or modifies
its state, it can make a difference if <code>reducerA</code> chooses to modify <code>reducerB</code>'s state
<em>before</em> or <em>after</em> <code>reducerB</code> runs.</p>

<p>This is perhaps most easily seen when working with <code>optional</code> reducers, where the parent
domain may listen to the child domain and <code>nil</code> out its state. If the parent reducer runs
before the child reducer, then the child reducer will not be able to react to its own action.</p>

<p>Similar can be said for a <code>forEach</code> reducer. If the parent domain modifies the child
collection by moving, removing, or modifying an element before the <code>forEach</code> reducer runs, the
<code>forEach</code> reducer may perform its action against the wrong element, an element that no longer
exists, or an element in an unexpected state.</p>

<p>Running a parent reducer before a child reducer can be considered an application logic
error, and can produce assertion failures. So you should almost always combine reducers in
order from child to parent domain.</p>

<p>Here is an example of how you should combine an <code>optional</code> reducer with a parent domain:</p>

<html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">parentReducer</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">ParentState</span>, <span class="type">ParentAction</span>, <span class="type">ParentEnvironment</span>&gt; =
  <span class="comment">// Run before parent so that it can react to `.dismiss` while state is non-`nil`.</span>
  <span class="variable">childReducer</span>
    .<span class="type">optional</span>
    .<span class="type">pullback</span>(
      <span class="variable">state</span>: \.<span class="type">child</span>,
      <span class="variable">action</span>: /<span class="variable">ParentAction</span>.<span class="type">child</span>,
      <span class="variable">environment</span>: { <span class="variable">$0</span>.<span class="type">child</span> }
    )
    <span class="comment">// Combined after child so that it can `nil` out child state upon `.child(.dismiss)`.</span>
    .<span class="type">combined</span>(
      <span class="variable">with</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a> { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
        <span class="keyword">switch</span> <span class="variable">action</span>
        <span class="keyword">case</span> .<span class="variable">child</span>(.<span class="variable">dismiss</span>):
          <span class="type">state</span>.<span class="type">child</span> = <span class="keyword">nil</span>
          <span class="keyword">return</span> .<span class="variable">none</span>
        ...
        }
      }
    )
</code></pre></body></html>
</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>other</th>
    <td><code class="type">Reducer</code></td>
    <td><p>Another reducer.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A single reducer.</p>

</div>
<div role="article" class="function" id="reducer.pullback(state:action:environment:)">
    <h3>
        <code>pullback(state:​action:​environment:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">pullback</span>&lt;<span class="variable">GlobalState</span>, <span class="variable">GlobalAction</span>, <span class="variable">GlobalEnvironment</span>&gt;(<span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="type">WritableKeyPath</span>&lt;<span class="type">GlobalState</span>, <span class="type">State</span>&gt;, <span class="variable">action</span> <span class="variable">toLocalAction</span>: <span class="type">CasePath</span>&lt;<span class="type">GlobalAction</span>, <span class="type">Action</span>&gt;, <span class="variable">environment</span> <span class="variable">toLocalEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">GlobalEnvironment</span>) -&gt; <span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">GlobalState</span>, <span class="type">GlobalAction</span>, <span class="type">GlobalEnvironment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Transforms a reducer that works on local state, action and environment into one that works on
global state, action and environment. It accomplishes this by providing 3 transformations to
the method:</p>

</div>
<div class="discussion">
    <ul>
<li>
<p>A writable key path that can get/set a piece of local state from the global state.</p>
</li>
<li>
<p>A case path that can extract/embed a local action into a global action.</p>
</li>
<li>
<p>A function that can transform the global environment into a local environment.</p>
</li>
</ul>

<p>This operation is important for breaking down large reducers into small ones. When used with
the <code>combine</code> operator you can define many reducers that work on small pieces of domain, and
then <em>pull them back</em> and <em>combine</em> them into one big reducer that works on a large domain.</p>

<html><body><pre class="highlight"><code><span class="comment">// Global domain that holds a local domain:</span>
<span class="keyword">struct</span> <span class="type">AppState</span> { <span class="keyword">var</span> <span class="variable">settings</span>: <span class="type">SettingsState</span>, <span class="comment">/* rest of state */</span> }
<span class="keyword">struct</span> <span class="type">AppAction</span> { <span class="keyword">case</span> <span class="variable">settings</span>(<span class="type">SettingsAction</span>), <span class="comment">/* other actions */</span> }
<span class="keyword">struct</span> <span class="type">AppEnvironment</span> { <span class="keyword">var</span> <span class="variable">settings</span>: <span class="type">SettingsEnvironment</span>, <span class="comment">/* rest of dependencies */</span> }

<span class="comment">// A reducer that works on the local domain:</span>
<span class="keyword">let</span> <span class="variable">settingsReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">SettingsState</span>, <span class="type">SettingsAction</span>, <span class="type">SettingsEnvironment</span>&gt; { ... }

<span class="comment">// Pullback the settings reducer so that it works on all of the app domain:</span>
<span class="keyword">let</span> <span class="variable">appReducer</span>: <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">AppState</span>, <span class="type">AppAction</span>, <span class="type">AppEnvironment</span>&gt; = .<span class="variable">combine</span>(
  <span class="variable">settingsReducer</span>.<span class="type">pullback</span>(
    <span class="variable">state</span>: \.<span class="type">settings</span>,
    <span class="variable">action</span>: /<span class="variable">AppAction</span>.<span class="type">settings</span>,
    <span class="variable">environment</span>: { <span class="variable">$0</span>.<span class="type">settings</span> }
  ),

  <span class="comment">/* other reducers */</span>
)
</code></pre></body></html>
</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>to​Local​State</th>
    <td><code class="type">Writable​Key​Path&lt;Global​State, State&gt;</code></td>
    <td><p>A key path that can get/set <code>State</code> inside <code>GlobalState</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Action</th>
    <td><code class="type">Case​Path&lt;Global​Action, Action&gt;</code></td>
    <td><p>A case path that can extract/embed <code>Action</code> from <code>GlobalAction</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Environment</th>
    <td><code class="type">@escaping (Global​Environment) -&gt; Environment</code></td>
    <td><p>A function that transforms <code>GlobalEnvironment</code> into <code>Environment</code>.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that works on <code>GlobalState</code>, <code>GlobalAction</code>, <code>GlobalEnvironment</code>.</p>

</div>
<div role="article" class="function" id="reducer.optional(_:_:)">
    <h3>
        <code>optional(_:​_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">optional</span>(<span class="keyword">_</span> <span class="variable">file</span>: <span class="type">StaticString</span> = <span class="keyword">#file</span>, <span class="keyword">_</span> <span class="variable">line</span>: <span class="type">UInt</span> = <span class="keyword">#line</span>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;
    <span class="type">State</span>?, <span class="type">Action</span>, <span class="type">Environment</span>
  &gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Transforms a reducer that works on non-optional state into one that works on optional state by
only running the non-optional reducer when state is non-nil.</p>

</div>
<div class="discussion">
    <p>Often used in tandem with <code>pullback</code> to transform a reducer on a non-optional local domain
into a reducer that can be combined with a reducer on a global domain that contains some
optional local domain:</p>

<html><body><pre class="highlight"><code><span class="comment">// Global domain that holds an optional local domain:</span>
<span class="keyword">struct</span> <span class="type">AppState</span> { <span class="keyword">var</span> <span class="variable">modal</span>: <span class="type">ModalState</span>? }
<span class="keyword">struct</span> <span class="type">AppAction</span> { <span class="keyword">case</span> <span class="variable">modal</span>(<span class="type">ModalAction</span>) }
<span class="keyword">struct</span> <span class="type">AppEnvironment</span> { <span class="keyword">var</span> <span class="variable">mainQueue</span>: <span class="type">AnySchedulerOf</span>&lt;<span class="type">DispatchQueue</span>&gt; }

<span class="comment">// A reducer that works on the non-optional local domain:</span>
<span class="keyword">let</span> <span class="variable">modalReducer</span> = <span class="variable">Reducer</span>&lt;<span class="variable">ModalState</span>, <span class="variable">ModalAction</span>, <span class="variable">ModalEnvironment</span> { ... }

<span class="comment">// Pullback the local modal reducer so that it works on all of the app domain:</span>
<span class="keyword">let</span> <span class="variable">appReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">AppState</span>, <span class="type">AppAction</span>, <span class="type">AppEnvironment</span>&gt;.<span class="type">combine</span>(
  <span class="variable">modalReducer</span>.<span class="type">optional</span>().<span class="type">pullback</span>(
    <span class="variable">state</span>: \.<span class="type">modal</span>,
    <span class="variable">action</span>: /<span class="variable">AppAction</span>.<span class="type">modal</span>,
    <span class="variable">environment</span>: { <span class="variable">ModalEnvironment</span>(<span class="variable">mainQueue</span>: <span class="variable">$0</span>.<span class="type">mainQueue</span>) }
  ),
  <span class="variable">Reducer</span> { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
    ...
  }
)
</code></pre></body></html>
<p>Take care when combining optional reducers into parent domains, as order matters. Always
combine optional reducers <em>before</em> parent reducers that can <code>nil</code> out the associated optional
state.</p>

<ul>
<li>
<p>See also: <code>IfLetStore</code>, a SwiftUI helper for transforming a store on optional state into a
store on non-optional state.</p>
</li>
<li>
<p>See also: <code>Store.ifLet</code>, a UIKit helper for doing imperative work with a store on optional
state.</p>
</li>
</ul>

</div>
</div>
<div role="article" class="function" id="reducer.foreach(state:action:environment:_:_:)">
    <h3>
        <code>for​Each(state:​action:​environment:​_:​_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">forEach</span>&lt;<span class="variable">GlobalState</span>, <span class="variable">GlobalAction</span>, <span class="variable">GlobalEnvironment</span>&gt;(<span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="type">WritableKeyPath</span>&lt;<span class="type">GlobalState</span>, [<span class="type">State</span>]&gt;, <span class="variable">action</span> <span class="variable">toLocalAction</span>: <span class="type">CasePath</span>&lt;<span class="type">GlobalAction</span>, (<span class="type">Int</span>, <span class="type">Action</span>)&gt;, <span class="variable">environment</span> <span class="variable">toLocalEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">GlobalEnvironment</span>) -&gt; <span class="type">Environment</span>, <span class="keyword">_</span> <span class="variable">file</span>: <span class="type">StaticString</span> = <span class="keyword">#file</span>, <span class="keyword">_</span> <span class="variable">line</span>: <span class="type">UInt</span> = <span class="keyword">#line</span>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">GlobalState</span>, <span class="type">GlobalAction</span>, <span class="type">GlobalEnvironment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>A version of <code>pullback</code> that transforms a reducer that works on an element into one that works
on a collection of elements.</p>

</div>
<div class="discussion">
    <html><body><pre class="highlight"><code><span class="comment">// Global domain that holds a collection of local domains:</span>
<span class="keyword">struct</span> <span class="type">AppState</span> { <span class="keyword">var</span> <span class="variable">todos</span>: [<span class="type">Todo</span>] }
<span class="keyword">struct</span> <span class="type">AppAction</span> { <span class="keyword">case</span> <span class="variable">todo</span>(<span class="variable">index</span>: <span class="type">Int</span>, <span class="variable">action</span>: <span class="type">TodoAction</span>) }
<span class="keyword">struct</span> <span class="type">AppEnvironment</span> { <span class="keyword">var</span> <span class="variable">mainQueue</span>: <span class="type">AnySchedulerOf</span>&lt;<span class="type">DispatchQueue</span>&gt; }

<span class="comment">// A reducer that works on a local domain:</span>
<span class="keyword">let</span> <span class="variable">todoReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">Todo</span>, <span class="type">TodoAction</span>, <span class="type">TodoEnvironment</span>&gt; { ... }

<span class="comment">// Pullback the local todo reducer so that it works on all of the app domain:</span>
<span class="keyword">let</span> <span class="variable">appReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">AppState</span>, <span class="type">AppAction</span>, <span class="type">AppEnvironment</span>&gt;.<span class="type">combine</span>(
  <span class="variable">todoReducer</span>.<span class="type">forEach</span>(
    <span class="variable">state</span>: \.<span class="type">todos</span>,
    <span class="variable">action</span>: /<span class="variable">AppAction</span>.<span class="type">todo</span>(<span class="variable">index</span>:<span class="type">action</span>:),
    <span class="variable">environment</span>: { <span class="keyword">_</span> <span class="keyword">in</span> <span class="variable">TodoEnvironment</span>() }
  ),
  <span class="variable">Reducer</span> { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
    ...
  }
)
</code></pre></body></html>
<p>Take care when combining <code>forEach</code> reducers into parent domains, as order matters. Always
combine <code>forEach</code> reducers <em>before</em> parent reducers that can modify the collection.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>to​Local​State</th>
    <td><code class="type">Writable​Key​Path&lt;Global​State, [State]&gt;</code></td>
    <td><p>A key path that can get/set an array of <code>State</code> elements inside. <code>GlobalState</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Action</th>
    <td><code class="type">Case​Path&lt;Global​Action, (Int, Action)&gt;</code></td>
    <td><p>A case path that can extract/embed <code>(Int, Action)</code> from <code>GlobalAction</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Environment</th>
    <td><code class="type">@escaping (Global​Environment) -&gt; Environment</code></td>
    <td><p>A function that transforms <code>GlobalEnvironment</code> into <code>Environment</code>.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that works on <code>GlobalState</code>, <code>GlobalAction</code>, <code>GlobalEnvironment</code>.</p>

</div>
<div role="article" class="function" id="reducer.foreach(state:action:environment:_:_:)">
    <h3>
        <code>for​Each(state:​action:​environment:​_:​_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">forEach</span>&lt;<span class="variable">GlobalState</span>, <span class="variable">GlobalAction</span>, <span class="variable">GlobalEnvironment</span>, <span class="variable">ID</span>&gt;(<span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="type">WritableKeyPath</span>&lt;<span class="type">GlobalState</span>, <a href="/swift-composable-architecture/IdentifiedArray"><span class="type">IdentifiedArray</span></a>&lt;<span class="type">ID</span>, <span class="type">State</span>&gt;&gt;, <span class="variable">action</span> <span class="variable">toLocalAction</span>: <span class="type">CasePath</span>&lt;<span class="type">GlobalAction</span>, (<span class="type">ID</span>, <span class="type">Action</span>)&gt;, <span class="variable">environment</span> <span class="variable">toLocalEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">GlobalEnvironment</span>) -&gt; <span class="type">Environment</span>, <span class="keyword">_</span> <span class="variable">file</span>: <span class="type">StaticString</span> = <span class="keyword">#file</span>, <span class="keyword">_</span> <span class="variable">line</span>: <span class="type">UInt</span> = <span class="keyword">#line</span>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">GlobalState</span>, <span class="type">GlobalAction</span>, <span class="type">GlobalEnvironment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>A version of <code>pullback</code> that transforms a reducer that works on an element into one that works
on an identified array of elements.</p>

</div>
<div class="discussion">
    <html><body><pre class="highlight"><code><span class="comment">// Global domain that holds a collection of local domains:</span>
<span class="keyword">struct</span> <span class="type">AppState</span> { <span class="keyword">var</span> <span class="variable">todos</span>: <a href="/swift-composable-architecture/IdentifiedArrayOf"><span class="type">IdentifiedArrayOf</span></a>&lt;<span class="type">Todo</span>&gt; }
<span class="keyword">struct</span> <span class="type">AppAction</span> { <span class="keyword">case</span> <span class="variable">todo</span>(<span class="variable">id</span>: <span class="type">Todo</span>.<span class="type">ID</span>, <span class="variable">action</span>: <span class="type">TodoAction</span>) }
<span class="keyword">struct</span> <span class="type">AppEnvironment</span> { <span class="keyword">var</span> <span class="variable">mainQueue</span>: <span class="type">AnySchedulerOf</span>&lt;<span class="type">DispatchQueue</span>&gt; }

<span class="comment">// A reducer that works on a local domain:</span>
<span class="keyword">let</span> <span class="variable">todoReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">Todo</span>, <span class="type">TodoAction</span>, <span class="type">TodoEnvironment</span>&gt; { ... }

<span class="comment">// Pullback the local todo reducer so that it works on all of the app domain:</span>
<span class="keyword">let</span> <span class="variable">appReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">AppState</span>, <span class="type">AppAction</span>, <span class="type">AppEnvironment</span>&gt;.<span class="type">combine</span>(
  <span class="variable">todoReducer</span>.<span class="type">forEach</span>(
    <span class="variable">state</span>: \.<span class="type">todos</span>,
    <span class="variable">action</span>: /<span class="variable">AppAction</span>.<span class="type">todo</span>(<span class="variable">id</span>:<span class="type">action</span>:),
    <span class="variable">environment</span>: { <span class="keyword">_</span> <span class="keyword">in</span> <span class="variable">TodoEnvironment</span>() }
  ),
  <span class="variable">Reducer</span> { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>
    ...
  }
)
</code></pre></body></html>
<p>Take care when combining <code>forEach</code> reducers into parent domains, as order matters. Always
combine <code>forEach</code> reducers <em>before</em> parent reducers that can modify the collection.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>to​Local​State</th>
    <td><code class="type">Writable​Key​Path&lt;Global​State, Identified​Array&lt;ID, State&gt;&gt;</code></td>
    <td><p>A key path that can get/set a collection of <code>State</code> elements inside <code>GlobalState</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Action</th>
    <td><code class="type">Case​Path&lt;Global​Action, (ID, Action)&gt;</code></td>
    <td><p>A case path that can extract/embed <code>(Collection.Index, Action)</code> from <code>GlobalAction</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Environment</th>
    <td><code class="type">@escaping (Global​Environment) -&gt; Environment</code></td>
    <td><p>A function that transforms <code>GlobalEnvironment</code> into <code>Environment</code>.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that works on <code>GlobalState</code>, <code>GlobalAction</code>, <code>GlobalEnvironment</code>.</p>

</div>
<div role="article" class="function" id="reducer.foreach(state:action:environment:_:_:)">
    <h3>
        <code>for​Each(state:​action:​environment:​_:​_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">forEach</span>&lt;<span class="variable">GlobalState</span>, <span class="variable">GlobalAction</span>, <span class="variable">GlobalEnvironment</span>, <span class="variable">Key</span>&gt;(<span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="type">WritableKeyPath</span>&lt;<span class="type">GlobalState</span>, [<span class="type">Key</span>: <span class="type">State</span>]&gt;, <span class="variable">action</span> <span class="variable">toLocalAction</span>: <span class="type">CasePath</span>&lt;<span class="type">GlobalAction</span>, (<span class="type">Key</span>, <span class="type">Action</span>)&gt;, <span class="variable">environment</span> <span class="variable">toLocalEnvironment</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">GlobalEnvironment</span>) -&gt; <span class="type">Environment</span>, <span class="keyword">_</span> <span class="variable">file</span>: <span class="type">StaticString</span> = <span class="keyword">#file</span>, <span class="keyword">_</span> <span class="variable">line</span>: <span class="type">UInt</span> = <span class="keyword">#line</span>) -&gt; <a href="/swift-composable-architecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">GlobalState</span>, <span class="type">GlobalAction</span>, <span class="type">GlobalEnvironment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>A version of <code>pullback</code> that transforms a reducer that works on an element into one that works
on a dictionary of element values.</p>

</div>
<div class="discussion">
    <p>Take care when combining <code>forEach</code> reducers into parent domains, as order matters. Always
combine <code>forEach</code> reducers <em>before</em> parent reducers that can modify the dictionary.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>to​Local​State</th>
    <td><code class="type">Writable​Key​Path&lt;Global​State, [Key:​ State]&gt;</code></td>
    <td><p>A key path that can get/set a dictionary of <code>State</code> values inside <code>GlobalState</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Action</th>
    <td><code class="type">Case​Path&lt;Global​Action, (Key, Action)&gt;</code></td>
    <td><p>A case path that can extract/embed <code>(Key, Action)</code> from <code>GlobalAction</code>.</p>
</td>
</tr>
<tr>
    <th>to​Local​Environment</th>
    <td><code class="type">@escaping (Global​Environment) -&gt; Environment</code></td>
    <td><p>A function that transforms <code>GlobalEnvironment</code> into <code>Environment</code>.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>A reducer that works on <code>GlobalState</code>, <code>GlobalAction</code>, <code>GlobalEnvironment</code>.</p>

</div>
<div role="article" class="function" id="reducer.run(_:_:_:)">
    <h3>
        <code>run(_:​_:​_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">run</span>(<span class="keyword">_</span> <span class="variable">state</span>: <span class="keyword">inout</span> <span class="type">State</span>, <span class="keyword">_</span> <span class="variable">action</span>: <span class="type">Action</span>, <span class="keyword">_</span> <span class="variable">environment</span>: <span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/Effect"><span class="type">Effect</span></a>&lt;<span class="type">Action</span>, <span class="type">Never</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Runs the reducer.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>state</th>
    <td><code class="type">inout State</code></td>
    <td><p>Mutable state.</p>
</td>
</tr>
<tr>
    <th>action</th>
    <td><code class="type">Action</code></td>
    <td><p>An action.</p>
</td>
</tr>
<tr>
    <th>environment</th>
    <td><code class="type">Environment</code></td>
    <td><p>An environment.</p>
</td>
</tr>
  </tbody>
</table>
  <h4>Returns</h4>
  <p>An effect that can emit zero or more actions.</p>

</div>
<div role="article" class="function" id="reducer.callasfunction(_:_:_:)">
    <h3>
        <code>call​AsFunction(_:​_:​_:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">callAsFunction</span>(<span class="keyword">_</span> <span class="variable">state</span>: <span class="keyword">inout</span> <span class="type">State</span>, <span class="keyword">_</span> <span class="variable">action</span>: <span class="type">Action</span>, <span class="keyword">_</span> <span class="variable">environment</span>: <span class="type">Environment</span>) -&gt; <a href="/swift-composable-architecture/Effect"><span class="type">Effect</span></a>&lt;<span class="type">Action</span>, <span class="type">Never</span>&gt;</code></pre></body></html>
</div>
    </section>



        </article>
    </main>

    <footer>
        <p>
    Generated on <time datetime="2021-03-31T20:25:51+0000">March 31, 2021</time> using <a href="https://github.com/SwiftDocOrg/swift-doc">swift-doc</a> <span class="version">1.0.0-beta.5</span>.
</p>
    </footer>
</body>
</html>
